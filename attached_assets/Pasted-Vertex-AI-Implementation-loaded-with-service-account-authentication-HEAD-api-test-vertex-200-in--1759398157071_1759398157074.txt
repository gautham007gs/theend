Vertex AI: Implementation loaded with service account authentication
 HEAD /api/test-vertex 200 in 1975ms
Server Action: Received message: hiii
Kruthika AI: Analyzing conversation context...
Conversation context: normal_chat
Token Optimization: Input tokens optimized by -8 chars (0% cost reduction)
Vertex AI: Sending optimized request to model...
Vertex AI: Received response from model
Vertex AI: Actual token usage - Input: 209, Output: 3
Token Optimization: Cached response for message: hiii...
Vertex AI: Successfully generated optimized response, length: 5
Vertex AI: Detailed error generating response: {
  error: ReferenceError: estimatedInputTokens is not defined
      at generateAIResponse (src/ai/vertex-ai.ts:175:34)
      at async generateResponse (src/ai/flows/emotional-state-simulation.ts:634:24)
      at async sendMessage (src/app/maya-chat/actions.ts:121:24)
    173 |     
    174 |     console.log(`Vertex AI: Successfully generated optimized response, length: ${text.length}`);
  > 175 |     console.log(`Token Usage: ~${estimatedInputTokens} input, ~${estimatedOutputTokens} output tokens`);
        |                                  ^
    176 |     return text;
    177 |     
    178 |   } catch (error) {,
  message: 'estimatedInputTokens is not defined',
  stack: 'ReferenceError: estimatedInputTokens is not defined\n' +
    '    at generateAIResponse (/home/runner/workspace/.next/server/chunks/ssr/[root-of-the-server]__30f17337._.js:830:38)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
    '    at async generateResponse (/home/runner/workspace/.next/server/chunks/ssr/[root-of-the-server]__30f17337._.js:2093:28)\n' +
    '    at async sendMessage (/home/runner/workspace/.next/server/chunks/ssr/[root-of-the-server]__30f17337._.js:2371:28)\n' +
    '    at async executeActionAndPrepareForRender (/home/runner/workspace/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:33:4423)\n' +
    '    at async /home/runner/workspace/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:33:2264\n' +
    '    at async handleAction (/home/runner/workspace/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:32:22678)\n' +
    '    at async renderToHTMLOrFlightImpl (/home/runner/workspace/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:38:39993)\n' +
    '    at async doRender (/home/runner/workspace/.next/server/chunks/ssr/node_modules_next_dist_45e51739._.js:2772:28)\n' +
    '    at async AppPageRouteModule.handleResponse (/home/runner/workspace/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:40:57383)\n' +
    '    at async handleResponse (/home/runner/workspace/.next/server/chunks/ssr/node_modules_next_dist_45e51739._.js:2921:32)\n' +
    '    at async handler (/home/runner/workspace/.next/server/chunks/ssr/node_modules_next_dist_45e51739._.js:3301:20)\n' +
    '    at async DevServer.renderToResponseWithComponentsImpl (/home/runner/workspace/node_modules/next/dist/server/base-server.js:1422:9)\n' +
    '    at async DevServer.renderPageComponent (/home/runner/workspace/node_modules/next/dist/server/base-server.js:1474:24)\n' +
    '    at async DevServer.renderToResponseImpl (/home/runner/workspace/node_modules/next/dist/server/base-server.js:1514:32)\n' +
    '    at async DevServer.pipeImpl (/home/runner/workspace/node_modules/next/dist/server/base-server.js:1025:25)\n' +
    '    at async NextNodeServer.handleCatchallRenderRequest (/home/runner/workspace/node_modules/next/dist/server/next-server.js:393:17)\n' +
    '    at async DevServer.handleRequestImpl (/home/runner/workspace/node_modules/next/dist/server/base-server.js:916:17)\n' +
    '    at async /home/runner/workspace/node_modules/next/dist/server/dev/next-dev-server.js:399:20\n' +
    '    at async Span.traceAsyncFn (/home/runner/workspace/node_modules/next/dist/trace/trace.js:157:20)\n' +
    '    at async DevServer.handleRequest (/home/runner/workspace/node_modules/next/dist/server/dev/next-dev-server.js:395:24)\n' +
    '    at async invokeRender (/home/runner/workspace/node_modules/next/dist/server/lib/router-server.js:240:21)\n' +
    '    at async handleRequest (/home/runner/workspace/node_modules/next/dist/server/lib/router-server.js:437:24)\n' +
    '    at async requestHandlerImpl (/home/runner/workspace/node_modules/next/dist/server/lib/router-server.js:485:13)\n' +
    '    at async Server.requestListener (/home/runner/workspace/node_modules/next/dist/server/lib/start-server.js:226:13)'
}
Kruthika AI: Error generating response: Error: Failed to generate AI response: estimatedInputTokens is not defined
    at generateAIResponse (src/ai/vertex-ai.ts:184:11)
    at async generateResponse (src/ai/flows/emotional-state-simulation.ts:634:24)
    at async sendMessage (src/app/maya-chat/actions.ts:121:24)
  182 |       stack: error instanceof Error ? error.stack : undefined
  183 |     });
> 184 |     throw new Error(`Failed to generate AI response: ${error instanceof Error ? error.message : 'Unknown error'}`);
      |           ^
  185 |   }
  186 | }
  187 |
Server Action: Generated enhanced response: hmm? ðŸ¤”
Server Action: New mood: technical_issue
ðŸ”§ Message processing time: 1569ms
 POST /maya-chat 200 in 1644ms